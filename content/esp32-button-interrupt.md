---
title: –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å –¥—Ä–µ–±–µ–∑–≥–∞ –∫–Ω–æ–ø–∫–∏ –≤ ESP32?
emoji: ü•∑
created: 2022-06-04
modified: 2022-06-04
tags:
  - ESP32
---

**–ó–∞–¥–∞—á–∞:** 

–í–∫–ª—é—á–∞—Ç—å –∏ –≤—ã–∫–ª—é—á–∞—Ç—å —Å–≤–µ—Ç–æ–¥–∏–æ–¥ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É. –ò—Å–∫–ª—é—á–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–π –¥—Ä–µ–±–µ–∑–≥ –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –Ω–∞–∂–∞—Ç–∏–∏.

–ü—Ä–æ–≥—Ä–∞–º–º—É –±—É–¥–µ–º –ø–∏—Å–∞—Ç—å –Ω–∞ [ESP-IDF](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/get-started/index.html).

–í –ø—Ä–æ–≥—Ä–∞–º–º–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:

- –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è;
- –¥–≤–æ–∏—á–Ω—ã–π —Å–µ–º–∞—Ñ–æ—Ä;
- —Ç–∞–π–º–µ—Ä;
- –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ;
- –∑–∞–¥–∞—á–∏;

**–†–µ—à–µ–Ω–∏–µ:**

–ù–∞ –∫–Ω–æ–ø–∫—É –ø–æ–≤–µ—Å–∏–º –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ. –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å —Å–µ–º–∞—Ñ–æ—Ä. –í–∫–ª—é—á–µ–Ω–∏–µ —Å–µ–º–∞—Ñ–æ—Ä–∞ –∂–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –≤ –Ω–∞—à–µ–π –∑–∞–ø—É—â–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏. –ö–∞–∫ —Ç–æ–ª—å–∫–æ —Å–µ–º–∞—Ñ–æ—Ä –≤–∫–ª—é—á–∏—Ç—å—Å—è —Å–≤–µ—Ç–æ–¥–∏–æ–¥ —Å–º–µ–Ω–∏—Ç —Å–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: —Å –≤–∫–ª—é—á–µ–Ω–Ω–æ–≥–æ –Ω–∞ –≤—ã–∫–ª—é—á–µ–Ω–Ω—ã–π –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç. –î–≤–æ–∏—á–Ω—ã–π —Å–µ–º–∞—Ñ–æ—Ä –∑–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —Å–æ–±—ã—Ç–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ–∂–∏–¥–∞–µ—Ç –ª–æ–≥–∏–∫–∞ –≤–Ω—É—Ç—Ä–∏ –∑–∞–ø—É—â–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏.

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–∞, –∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–∞–∫ –¥—Ä–µ–±–µ–∑–≥ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–∫—Ä–æ –Ω–∞–∂–∞—Ç–∏–π. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ç–æ–º—É, —á—Ç–æ –∑–∞ –æ–¥–Ω–æ –Ω–∞–∂–∞—Ç–∏–µ —Å–≤–µ—Ç–æ–¥–∏–æ–¥ –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∏—Ç—å—Å—è –∏ –≤—ã–∫–ª—é—á–∏—Ç—å—Å—è. –ù–∞–º –∂–µ –Ω—É–∂–Ω–æ —á—Ç–æ–±—ã –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ –≤—ã–ø–æ–ª–Ω—è–ª–æ—Å—å –æ–¥–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ.

–ë—ã—Å—Ç—Ä—ã–º —Ä–µ—à–µ–Ω–∏–µ–º –º–æ–≥–ª–∞ –±—ã —Å—Ç–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–µ—Ä–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä–∞ (0.1 uF) –º–µ–∂–¥—É –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞. –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é –∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä –Ω–µ —É—Å—Ç—Ä–∞–Ω–∏—Ç –¥—Ä–µ–±–µ–∑–≥ –ø–æ–ª–Ω–æ—Å—Ç—å—é. –î–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –¥—Ä–µ–±–µ–∑–≥–∞ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ. –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –º—ã –æ—Ç–∫–ª—é—á–∏–º –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫–µ –∏ –≤–∫–ª—é—á–∏–º –µ–≥–æ –ø–æ —Ç–∞–π–º–µ—Ä—É —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É (–≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–¥–∞—Ç—å –ª—é–±–æ–µ –¥—Ä—É–≥–æ–µ –≤—Ä–µ–º—è). –¢–∞–∫ –∫–∞–∫ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫–µ –±—É–¥–µ—Ç –≤—ã–∫–ª—é—á–µ–Ω–æ –Ω–∞ 1 —Å–µ–∫—É–Ω–¥—É —ç—Ç–æ —É—Å—Ç—Ä–∞–Ω–∏—Ç –≤–æ–∑–º–æ–∂–Ω—ã–π –¥—Ä–µ–±–µ–∑–≥.

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ —á—Ç–æ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–π–º–µ—Ä–æ–º –∏ –¥–≤–æ–∏—á–Ω—ã–º —Å–µ–º–∞—Ñ–æ—Ä–æ–º –æ–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –Ω–∞ —Å–ª–æ–≤–æ `ISR`. –≠—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏–º–µ–Ω–Ω–æ –¥–ª—è –≤—ã–∑–æ–≤–∞ –∏–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è.

```c
#include "driver/gpio.h"
#include "esp_log.h"
#include "freertos/FreeRTOS.h"
#include "freertos/task.h"
#include "freertos/semphr.h"
#include "freertos/timers.h"

static const char *LOG_TAG = "Application";
static const gpio_num_t LED_PIN = GPIO_NUM_2;
static const gpio_num_t BUTTON_PIN = GPIO_NUM_22;
static SemaphoreHandle_t led_semphr = NULL;
static TimerHandle_t button_timer = NULL;

void buttonTimerHandle(TimerHandle_t timer)
{
    // –í–∫–ª—é—á–∞–µ–º –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–µ
    gpio_intr_enable(BUTTON_PIN);
}

void vLedTask(void *pvParams)
{
    bool led_state = false;
    for (;;)
    {
        if (xSemaphoreTake(led_semphr, portMAX_DELAY) == pdTRUE)
        {
            led_state = !led_state;
            ESP_LOGI(LOG_TAG, "LED is %s", led_state ? "On" : "Off");
            gpio_set_level(LED_PIN, led_state);
        }
    }
}

static void IRAM_ATTR button_isr_handler(void *arg)
{
    // –û—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–µ, —á—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å –¥—Ä–µ–±–µ–∑–≥
    gpio_intr_disable(BUTTON_PIN);
    // –í–∫–ª—é—á–∞–µ–º —Å–µ–º–∞—Ñ–æ—Ä
    xSemaphoreGiveFromISR(led_semphr, pdFALSE);
    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
    xTimerStartFromISR(button_timer, pdFALSE);
}

void app_main(void)
{
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ LED
    gpio_pad_select_gpio(LED_PIN);
    gpio_set_direction(LED_PIN, GPIO_MODE_OUTPUT);

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏
    gpio_pad_select_gpio(BUTTON_PIN);
    ESP_ERROR_CHECK(gpio_set_direction(BUTTON_PIN, GPIO_MODE_INPUT));
    ESP_ERROR_CHECK(gpio_pulldown_en(BUTTON_PIN));                      // —Å—Ç—è–Ω—É—Ç –∫ GND
    ESP_ERROR_CHECK(gpio_set_intr_type(BUTTON_PIN, GPIO_INTR_POSEDGE)); // –ø–µ—Ä–µ—Ö–æ–¥ –æ—Ç –Ω–∏–∑–∫–æ–≥–æ –∫ –≤—ã—Å–æ–∫–æ–º—É –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—é
    ESP_ERROR_CHECK(gpio_install_isr_service(0));
    ESP_ERROR_CHECK(gpio_isr_handler_add(BUTTON_PIN, button_isr_handler, (void *)BUTTON_PIN));

    // –°–æ–∑–¥–∞–Ω–∏–µ –¥–≤–æ–∏—á–Ω–æ–≥–æ —Å–µ–º–∞—Ñ–æ—Ä–∞
    led_semphr = xSemaphoreCreateBinary();

    // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ —Ç–∞–π–º–µ—Ä–∞ –Ω–∞ 1 —Å–µ–∫—É–Ω–¥—É (–±–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞)
    button_timer = xTimerCreate(
        "Button timer",
        1000 / portTICK_PERIOD_MS,
        pdFALSE,
        NULL,
        buttonTimerHandle);

    // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
    xTaskCreate(vLedTask, "LED Task", 3000, NULL, 1, NULL);
}
```
---
title: –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ SPIFFS –≤ ESP32
emoji: üöÄ
created: 2022-06-12
modified: 2022-06-12
tags:
  - ESP32
---

SPIFFS (serial peripheral interface flash file system) ‚Äî —ç—Ç–æ —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–∞—è –¥–ª—è —Ñ–ª—ç—à-—É—Å—Ç—Ä–æ–π—Å—Ç–≤. –û–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –∏–∑–Ω–æ—Å–∞, –ø—Ä–æ–≤–µ—Ä–∫—É —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ.

- –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ SPIFFS –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞—Ç–∞–ª–æ–≥–∏;
- –≠—Ç–æ –Ω–µ —Å—Ç–µ–∫ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –û–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–ø–∏—Å–∏ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≥–æ—Ä–∞–∑–¥–æ –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, —á–µ–º –¥—Ä—É–≥–∞—è.
- –ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–æ—Ö–∏–µ –±–ª–æ–∫–∏.
- SPIFFS –º–æ–∂–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–∫–æ–ª–æ 75% –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ —Ä–∞–∑–¥–µ–ª–∞.
- –ö–æ–≥–¥–∞ –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –º–µ—Å—Ç–æ, —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –Ω–∞–π—Ç–∏ —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ, —Å–∫–∞–Ω–∏—Ä—É—è —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑, —á—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –¥–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ–∫—É–Ω–¥ –Ω–∞ –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–ø–∏—Å–∏, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç—Ä–µ–±—É–µ–º–æ–≥–æ –º–µ—Å—Ç–∞.
- –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –Ω–µ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —É–¥–∞–ª–µ–Ω–∏—é –≤—Å–µ–≥–æ —Ñ–∞–π–ª–∞, –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —á–µ–≥–æ –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ä–∞–∑–¥–µ–ª—ã.
- –ö–æ–≥–¥–∞ ESP32 –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç –ø–æ—Ç–µ—Ä—é –ø–∏—Ç–∞–Ω–∏—è –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã, —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—é SPIFFS. –û–¥–Ω–∞–∫–æ —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Å –ø–æ–º–æ—â—å—é `esp_spiffs_check`.

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è SPIFFS –ø–∞–º—è—Ç–∏ –Ω—É–∂–Ω–æ —Ä–∞–∑–º–µ—Ç–∏—Ç—å –µ–µ –≤ —Ç–∞–±–ª–∏—Ü–µ —Ä–∞–∑–¥–µ–ª–æ–≤ `partitions.csv`:

```csv
# ESP-IDF Partition Table
# Name,   Type, SubType, Offset,  Size, Flags
nvs,      data, nvs,     0x9000,  24K,
phy_init, data, phy,     ,        4K,
spiffs,   data, spiffs,  ,        500K,
factory,  app,  factory, ,        7600K,
```

–§–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ PlatformIO:

```ini
[env:esp32dev]
platform = espressif32
board = esp32dev
framework = espidf
monitor_speed = 115200
monitor_filters = esp32_exception_decoder
monitor_port = /dev/cu.SLAB_USBtoUART
upload_port = /dev/cu.SLAB_USBtoUART
board_upload.flash_size = 8MB
board_upload.maximum_size=8388608
board_build.partitions = partitions.csv
```

–í PlatformIO —Å–æ–∑–¥–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥ `data`, –≤—Å–µ —á—Ç–æ –≤ –Ω–µ–º –±—É–¥–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞—Ç—å –Ω–∞ ESP32 –∫–∞–∫ —Ñ–∞–π–ª. –ù–µ –∑–∞–±—ã–≤–∞–µ–º —á—Ç–æ SPIFFS –Ω–µ —É–º–µ–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫–∞—Ç–∞–ª–æ–≥–∞–º–∏, –∫–∞—Ç–∞–ª–æ–≥–∏ –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ `data` —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ–ª—å–∑—è.

![ESP32 SPIFFS Folder](./esp32-spiffs/data_folder.png)

–î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ –µ–≥–æ –Ω—É–∂–Ω–æ —Å–±–∏–ª–¥–∏—Ç—å (**Platform -> Build Filesystem Image**) –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤ ESP32 (**Platform -> Upload Filesystem Image**).

![ESP32 Build and upload SPIFFS](./esp32-spiffs/steps.png)

–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω –ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –∫–∞–∫ –º–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –∏–∑ `data/hello.txt`:

```c
#include "freertos/FreeRTOS.h"
#include "esp_log.h"
#include "esp_spiffs.h"

static const char *TAG = "NVS";

void app_main(void)
{
    esp_vfs_spiffs_conf_t conf = {
        .base_path = "/spiffs",
        .partition_label = NULL,
        .max_files = 5,
        .format_if_mount_failed = true};

    ESP_ERROR_CHECK(esp_vfs_spiffs_register(&conf));
    FILE *f = fopen("/spiffs/hello.txt", "r");
    if (f == NULL)
    {
        ESP_LOGE(TAG, "Failed to open file for reading");
        return;
    }
    char line[64];
    fgets(line, sizeof(line), f);
    fclose(f);
    ESP_LOGI(TAG, "Read from file: '%s'", line);
    // All done, unmount partition and disable SPIFFS
    esp_vfs_spiffs_unregister(conf.partition_label);
}
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ SPIFFS –º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –≤ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ ESP-IDF](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/storage/spiffs.html).
